<!doctype html>
<html lang="zh-cn">
<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.78.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Host头部攻击 | GET command and control</title>
    <meta property="og:title" content="Host头部攻击 - GET command and control">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2020-11-05T16:02:41&#43;08:00">
        
        
    <meta property="article:modified_time" content="2020-11-05T16:02:41&#43;08:00">
        
    <meta name="Keywords" content="penetration">
    <meta name="description" content="Host头部攻击">
        
    <meta name="author" content="KUHAKU">
    <meta property="og:url" content="https://GETC2.github.io/post/host-head-attack/">
    <link rel="shortcut icon" href="/favicon-bug.ico" type="image/x-icon">

    <link rel="stylesheet" href="/css/normalize.css">
    
        <link rel="stylesheet" href="/css/prism.css">
    
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

    


    
    
</head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://GETC2.github.io/">
                        GET command and control
                    </a>
                
                <p class="description">Stay hungry. Stay foolish.</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://GETC2.github.io/">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">Host头部攻击</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2020年11月5日
                        </date>
                        
                        
                        
                        <div class="post-content">
                            <h1 id="host头部由来">Host头部由来</h1>
<p>HTTP/1.1强制要求Host请求头。在以下几种情况下，没有Host头部无法获得请求的资源。</p>
<ul>
<li>在服务器同时伺服多个域名的时候，服务器需要知道请求所指向的具体域名。</li>
<li>客户端与多个后端之间存在中间节点，比如负载均衡器和反向代理。此时中间节点需要知道具体的域名确定负责请求的后端。</li>
</ul>
<h1 id="host头部攻击">Host头部攻击</h1>
<p>Host头部攻击主要是利用网站对Host头部的不当处理。如果网站不对Host头部进行适当的验证或转义，在头部被注入payload的情况下，攻击者就可以利用这种攻击来控制服务器的行为。通过对Host头部进行注入的攻击叫做Host头部注入攻击。</p>
<p>现成的web应用往往不知道自己部署在哪个域名上，除非域名在configuration里面注明。当应用需要生成带有域名的资源路径的时候，应用可能会从Host头部取值。</p>
<p>另外一种情况是Host头部被用于应用的不同系统之间的交互。比如反向代理服务器会查看Host头部用来将请求转发到正确的后端服务器进行处理。如果Host头部被篡改，而且代理服务器没有验证头部，攻击者可以利用代理服务器访问内网或者进行SSRF攻击。</p>
<p>由于Host头部有多种用途，通过Host头部注入攻击可以实现其他攻击，比如：</p>
<ol>
<li>web缓存毒化</li>
<li>攻击特定业务逻辑</li>
<li>基于路由的SSRF</li>
<li>经典的服务端漏洞，比如SQL注入</li>
</ol>
<h1 id="host头部漏洞的成因">Host头部漏洞的成因</h1>
<ol>
<li>应用假定Host头部无法被用户控制，因而没有对头部进行适当的验证和转义。</li>
<li>服务器的configuration不合适。有时应用对Host头部进行了适当的验证和转义，但是由于不适当的服务器configuration，导致Host头部可以通过注入其他头部来覆盖，比如X-forwarded-for头部。</li>
</ol>
<h1 id="如何确认host头部漏洞">如何确认Host头部漏洞</h1>
<p>基本的思路是验证通过修改Host头部是否还能得到正常的响应。</p>
<ol>
<li>
<p>修改Host头部为无意义的值</p>
<p>头部变为无意义的值后，一种情况是得到“Invalid Host header”，这一般是由于中间节点或者后端服务器需要正确的Host头部来转发请求。另一种情况是得到正常的响应。这种情况可能是由于服务器被配置为如果有无法识别的Host头部，将请求转发到默认的网站。</p>
<p>在得到“Invalid Host header”之后，还有其他方法来绕过验证。</p>
</li>
<li>
<p>利用有缺陷的验证</p>
<p>有的时候服务器对Host头部的验证是有缺陷的。比如说有的解析算法会忽略Host头部后面的端口：example.com:xx。这种情况下可以在端口部分注入payload。还有的服务器会验证Host头部是否以合适的域名结尾，这种情况下可以在源域名的基础上申请子域名来绕过验证。</p>
</li>
<li>
<p>发送有歧义的Host头部</p>
<p>有的时候对Host头部进行验证的系统和利用头部并造成漏洞的系统不是同一个系统。通过利用这些系统对Host头部处理的不一致也可以成功进行攻击。具体来说，通过发送有歧义的请求，不同系统对这个请求会做出不同的选择，从而绕过验证并且注入payload。</p>
<ul>
<li>
<p>注入重复的头部</p>
<p>不同的系统对重复的头部处理方法可能不同，导致在一个系统中其中一个Host头部覆盖掉另一个，而在另一个系统正相反。</p>
</li>
<li>
<p>在请求行注入绝对路径</p>
<p>有的服务器理解请求行的绝对路径。在请求行的优先于Host头部的时候就可以对头部注入payload。</p>
</li>
<li>
<p>在头部添加换行</p>
<p>一些服务器把一开始有空格的头部当成上一个头部的换行，而一些服务器忽略空格。</p>
<pre><code>GET /example HTTP/1.1
  Host: bad-stuff-here
 Host: vulnerable-website.com
</code></pre></li>
</ul>
</li>
<li>
<p>注入覆盖Host头部的其他头部</p>
<p>有的时候请求经过中间节点后，Host头部会被改变，为了保存原来的头部，中间节点会添加<code>X-Forwarded-Host</code>来注明原来的Host头部。</p>
</li>
</ol>

                        </div>

                        


                        


                        <div class="post-meta meta-tags">
                            
                            没有标签
                            
                        </div>
                    </article>
                    
    

    
    
                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        <form id="search" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://GETC2.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">订阅</h3>
        <ul class="widget-list">
            <li><a href="https://GETC2.github.io/index.xml">RSS</a></li>
        </ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
</ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://GETC2.github.io/post/empire/" title="Empire">Empire</a>
    </li>
    
    <li>
        <a href="https://GETC2.github.io/post/netcat_port_forward/" title="Netcat port forward">Netcat port forward</a>
    </li>
    
    <li>
        <a href="https://GETC2.github.io/post/veil/" title="Veil">Veil</a>
    </li>
    
    <li>
        <a href="https://GETC2.github.io/post/nmap/" title="Nmap">Nmap</a>
    </li>
    
    <li>
        <a href="https://GETC2.github.io/post/recon-ng/" title="Recon-ng">Recon-ng</a>
    </li>
    
    <li>
        <a href="https://GETC2.github.io/post/metadata-threasure-hunt/" title="Metadata Treasure Hunt">Metadata Treasure Hunt</a>
    </li>
    
    <li>
        <a href="https://GETC2.github.io/post/egress-analysis/" title="Egress Analysis">Egress Analysis</a>
    </li>
    
    <li>
        <a href="https://GETC2.github.io/post/accessing-internal-websites/" title="Accessing Internal Websites">Accessing Internal Websites</a>
    </li>
    
    <li>
        <a href="https://GETC2.github.io/post/access-restricted-func/" title="Access Restricted Func">Access Restricted Func</a>
    </li>
    
    <li>
        <a href="https://GETC2.github.io/post/web-cache-poison/" title="Web Cache Poisoning">Web Cache Poisoning</a>
    </li>
    
</ul>

    </section>
    

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
</div>
    </section>

    

    </div>

        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
        &copy; 2021 <a href="https://GETC2.github.io/">GET command and control</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/skydamon/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    <script type="text/javascript">
    
    (function(){
        $("pre code").parent().addClass("line-numbers")
    }())

    window.MathJax = {
        tex2jax: {
            inlineMath: [ ['$','$'] ],
            processEscapes: true
        }
    };
    </script>
    <script type="text/javascript" src="/js/prism.js" async="true"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src="/js/totop.js?v=0.0.0" async=""></script>







</body>
</html>
