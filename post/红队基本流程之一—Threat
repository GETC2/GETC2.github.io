---
title: "红队基本流程之一—Threat Intelligence"
date: 2021-02-05T14:13:26+08:00
draft: false
---

# 红队基本流程之一：Threat Intelligence

# 简介

在进行红队活动时，需要遵循一定的框架和方法。这里的框架和方法确定了针对特定目标进行模拟红队行动的宏观步骤。如今存在着很多可供选择的框架和方法，这里我们介绍其中一个，总共分为四个步骤，如下图所示：

![](https://cdn.jsdelivr.net/gh/GETC2/blog-pics@master/img/Snipaste_2021-02-05_14-19-59.png)

我们首先介绍第一步，即`Threat Intelligence`。

## `Threat Intelligence`基本步骤

`Threat Intelligence`意味着收集有关威胁的情报。即针对我们所要进行模拟攻击的目标，现实中可能对此目标进行攻击的威胁的情报。有了相关的情报，我们可以有针对性地模拟此威胁来攻击目标。

而这一步其实也分很多小步骤：

1. 了解目标组织
2. 确定`Adevesary`
3. 收集威胁情报
4. 确定威胁使用的`TTP`
5. 创建威胁的`Profile`
6. 把收集到的`TTP`映射到`MITRE ATT&CK`矩阵中
7. 确定模拟`Adversary`的计划

下面我们就分别介绍这些步骤，其中可能穿插一些补充的点。

### 1. 了解目标组织

这一步骤的目标是了解目标组织，行业以及所在国家的威胁形势(`Threat landscape`)。红队需要了解针对目标的可能攻击手段(`attack surface`)。最终就是确定针对目标的人员，`processes`和技术的可能的攻击方法。

在这里，我们模拟了一个目标公司：`SEC564`，这个是为了说明的虚拟目标组织。我们所能接触到的关于该公司的信息来源于官网：

`We offer consulting services to Fortune 500 and government agencies in the United States and Saudi Arabia focused on aviation and energy sector. Please use the content page to get in touch with us. Most of our business comes referred and we are very picky when choosing our customers.`

### 2. 确定`Adversary`

从之前的目标官网上，我们可以获得以下几个关键词："United States", '"Saudi Arabia", "Aviation", "Energy"。我们可以直接在`MITRE ATT&CK`官网上搜索这些关键词，就会发现以往针对这些类似目标的`APT`组织：

![](https://cdn.jsdelivr.net/gh/GETC2/blog-pics@master/img/Snipaste_2021-02-05_14-57-04.png)

在针对关键词`Aviation`进行搜索时，我们发现`APT33/Elfin`可能会对我们的目标进行攻击。

### 3. 收集威胁情报

关于威胁的情报有许多种，以下的金字塔图片描述了关于特定威胁的情报种类：

![](https://cdn.jsdelivr.net/gh/GETC2/blog-pics@master/img/Snipaste_2021-02-05_15-02-44.png)

这其中，红队关注的并不是哈希，IP地址，域名之类的，这些信息都是`Indicators of Compromise （IoC`。作为红队，我们关注的是威胁所使用的工具和`TTP`，有了这些信息，我们才能模拟威胁对目标进行攻击。

### 4. 确定`Adversary`使用的`TTP`

这一步需要从搜集的情报中确定威胁使用的`TTP`并映射到`ATT&CK`。所谓的`TTP`是`Tactics, Techniques and Procedures`的缩写。

* `Tactics`是达成目标的概括性的方法，比如`initial access, lateral movement`
* `Techniques`是针对`Tactics`的进一步细化，比如针对`initial access`，可以通过钓鱼邮件实现
* `Procedures`是更为细致的步骤，比如针对钓鱼邮件，从基础设施的搭建，到如何投递邮件等等

从一些针对`APT`组织的报告中，我们就可以确定对方使用的`TTP`，比如：

![](https://cdn.jsdelivr.net/gh/GETC2/blog-pics@master/img/Snipaste_2021-02-05_15-15-21.png)

### 5. 创建`Adversary`的`profile`

通过建立`profile`，我们可以设计一个高度概括的红队活动计划。目的是展示红队需要模拟什么样的`Adeversary`。

这个`profile`包括以下几个方面：

1. 关于`Adversary`的描述
2. 目标
3. `Initial Access`
4. `Execution`
5. `Persistence`
6. `Privilege Escalation`
7. `Defense Evasion`
8. `Credential Access`
9. `Discovery`
10. `Lateral Movement`
11. `C2`
12. Exfiltration

### 6. 利用`MITRE ATT&CK`来过滤`TTP`

`MITRE ATT&CK` 的官网可以针对特定的`APT`来过滤，显示使用的`TTP`。这个可以作为对我们之前搜集的情报的补充。

![](https://cdn.jsdelivr.net/gh/GETC2/blog-pics@master/img/Snipaste_2021-02-05_15-46-30.png)

### 7. 设定模拟计划

确定好`TTP`后，下一步就是拟定模拟`Adversary`的计划。这就是框架的下一个步骤。

下面是`MITRE`官网针对`APT3`的`TTP`所设定的模拟计划：

![](https://cdn.jsdelivr.net/gh/GETC2/blog-pics@master/img/Snipaste_2021-02-05_15-54-26.png)